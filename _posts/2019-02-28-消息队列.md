---
layout:  post
title:		消息队列
subtitle:		消息队列
date:     2018-12-30
author:   Fogeeks
header-img: img/post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Rabbitmq
    - Kafka
    - 消息队列
---

- 基础
    #### 元数据 ：queue , exchange , binding , virtualhost, node info
#### 安装
    - docker pull rabbitmq:3.6.14-management
    ```
        sudo docker run -d  --name rabbitmq-a \
        -p 4669:4369 \
        -p 5671:5671 \
        -p 5672:5672 \
        -p 25672:25672 \
        -p 15672:15672 \
        -h node1 \
        -e RABBITMQ_NODENAME=rabbit \
        -e RABBITMQ_DEFAULT_USER=admin \
        -e RABBITMQ_DEFAULT_PASS=admin \
        -v /usr/local/docker_app/rabbitmq/rabbitmq-a/data:/var/lib/rabbitmq \
        rabbitmq:3.6.14-management

        sudo docker run -d  --name  rabbitmq-b \
        -p 4469:4369 \
        -p 5771:5671 \
        -p 5772:5672 \
        -p 26672:25672 \
        -p 16672:15672 \
        -h node2 \
        -e RABBITMQ_NODENAME=rabbit \
        -e RABBITMQ_DEFAULT_USER=admin \
        -e RABBITMQ_DEFAULT_PASS=admin \
        -v /usr/local/docker_app/rabbitmq/rabbitmq-b/data:/var/lib/rabbitmq \
        rabbitmq:3.6.14-management

        sudo docker  run -d  --name  rabbitmq-c \
        -p 4569:4369 \
        -p 5871:5671 \
        -p 5872:5672 \
        -p 27672:25672 \
        -p 17672:15672 \
        -h node3 \
        -e RABBITMQ_NODENAME=rabbit \
        -e RABBITMQ_DEFAULT_USER=admin \
        -e RABBITMQ_DEFAULT_PASS=admin \
        -v /usr/local/docker_app/rabbitmq/rabbitmq-c/data:/var/lib/rabbitmq \
        rabbitmq:3.6.14-management

        sudo docker create --name rabbitmq-c \
        -p 4569:4369 \
        -p 5871:5671 \
        -p 5872:5672 \
        -p 27672:25672 \
        -p 17672:15672 \
        -h node3 \
        -e RABBITMQ_NODENAME=rabbit \
        -e RABBITMQ_DEFAULT_USER=admin \
        -e RABBITMQ_DEFAULT_PASS=admin \
        -v /usr/local/docker_app/rabbitmq/rabbitmq-c/data:/var/lib/rabbitmq \
        rabbitmq:3.6.14-management
    ```
#### 启动
    - sudo docker run -d --hostname rabbit-alone --name rabbit-alone -p 15672:15672 -p 5672:5672  rabbitmq
#### 进入对应容器
    - sudo docker exec -it rabbit-alone  /bin/bash
#### 场景
    - 异步 如推送提醒消息给用户
    - 解耦 如订单系统库存系统结算系统之间的节藕
    - 肖峰 如高并发场景下请求排队
#### 重难点
    - 消息持久化：设置durable为true
    - 消息可靠性：生产者继承confirmCallback,消费者手动ack确认，成功就调用basicack否则调用basicnack

#### 常用命令
    - stop restart  => rabbitmq-server –detached   /  rabbitmqctl stop
    - check status => rabbitmqctl status  / rabbitmqctl list_queues  / rabbitmqctl list_exchanges /
    - rabbitmqctl list_bindings /rabbitmqctl list_connections / rabbitmqctl  list_channels
    - clear queues => rabbitmqctl reset
    - add user => sudo rabbitmqctl  add_user  hechao hechao
    - add permission => sudo rabbitmqctl  set_user_tags  hechao administrator

#### 消息生产消费详细步骤

#### 消息丢失

#### 消息重复

#### rabbit和kafka对比
